<section class="py-24 bg-sloe-bg-card border-y border-sloe-bg-border">
  <div class="max-w-container mx-auto px-page">
    <h2 class="text-4xl md:text-5xl font-bold font-heading text-sloe-text-headings text-center mb-4" style="line-height: 1.2">
      {{ section.settings.heading_line1 }} <span class="text-sloe-primary">{{ section.settings.heading_line2 }}</span>
    </h2>
    <p class="text-center text-lg text-sloe-text-body/90 mb-16 max-w-2xl mx-auto">
      {{ section.settings.subheading }}
    </p>

    <div class="grid lg:grid-cols-5 gap-8">
      <!-- Left Column: Bundle Selection -->
      <div class="lg:col-span-2 space-y-4" id="bundle-selector">
        {% for block in section.blocks %}
          <div data-bundle-index="{{ forloop.index0 }}" class="bundle-option p-5 rounded-card border transition-all duration-200 cursor-pointer {% if forloop.first %}bg-sloe-bg-default border-sloe-primary ring-2 ring-sloe-primary/50{% else %}bg-sloe-bg-default/50 border-sloe-bg-border hover:border-sloe-accent{% endif %}">
            <h3 class="text-xl font-bold font-heading text-sloe-text-headings">{{ block.settings.bundle_name }}</h3>
            <p class="text-sloe-text-body/80 mt-1 text-sm">{{ block.settings.bundle_description }}</p>
            <p class="text-lg font-bold mt-2 text-sloe-primary">
              Save ${{ block.settings.savings }}
            </p>
          </div>
        {% endfor %}
      </div>

      <!-- Right Column: Bundle Details -->
      <div class="lg:col-span-3 bg-sloe-bg-default p-8 rounded-card border border-sloe-bg-border sticky lg:top-24 h-fit" id="bundle-details">
        <!-- Content will be dynamically updated by JS -->
        {% assign first_bundle = section.blocks.first %}
        <h3 class="text-3xl font-bold font-heading text-sloe-text-headings mb-4 bundle-name">
          {{ first_bundle.settings.bundle_name }} Details
        </h3>

        <!-- Items List -->
        <div class="space-y-3 mb-6 bundle-items">
          {% assign items = first_bundle.settings.bundle_items | split: ',' %}
          {% for item in items %}
            <div class="flex items-center text-sloe-text-body">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-sloe-primary mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
              <span class="text-lg">{{ item | strip }}</span>
            </div>
          {% endfor %}
        </div>
        
        <!-- Pricing -->
        <div class="bg-sloe-bg-card p-5 rounded-btn border border-sloe-bg-border">
          <p class="text-sm text-sloe-text-body/70 line-through bundle-original-price">Retail: ${{ first_bundle.settings.original_price }}</p>
          <div class="flex justify-between items-end mt-1">
            <p class="text-sloe-primary text-4xl font-bold font-heading bundle-price">
              ${{ first_bundle.settings.bundle_price }}
            </p>
            <span class="text-sloe-accent font-bold bg-sloe-primary/10 p-2 rounded-btn text-sm bundle-savings">
              YOU SAVE ${{ first_bundle.settings.savings }}
            </span>
          </div>
        </div>

        <!-- CTA -->
        <div class="mt-8">
          <a href="{{ first_bundle.settings.cta_url }}" class="bundle-cta bg-sloe-primary text-sloe-text-on-primary rounded-btn py-3 px-6 font-bold font-heading hover:bg-sloe-accent transition-colors duration-200 active:ring-4 ring-sloe-primary/50 w-full text-xl py-4 transition-transform transform hover:scale-[1.01] active:scale-100 inline-block text-center">
          Add {{ first_bundle.settings.bundle_name }} to Cart
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Store bundle data for JS -->
<script type="application/json" id="bundle-data">
  {
    "bundles": [
      {% for block in section.blocks %}
        {
          "name": {{ block.settings.bundle_name | json }},
          "description": {{ block.settings.bundle_description | json }},
          "items": {{ block.settings.bundle_items | json }},
          "originalPrice": {{ block.settings.original_price | json }},
          "bundlePrice": {{ block.settings.bundle_price | json }},
          "savings": {{ block.settings.savings | json }},
          "ctaUrl": {{ block.settings.cta_url | json }}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
</script>

{% schema %}
{
  "name": "Bundle Selector",
  "settings": [
    {
      "type": "text",
      "id": "heading_line1",
      "label": "Heading Line 1",
      "default": "Don't Buy Retail."
    },
    {
      "type": "text",
      "id": "heading_line2",
      "label": "Heading Line 2 (Highlighted)",
      "default": "Bundle & Save Big."
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Choose a performance bundle below to get immediate discounts on our most popular products."
    }
  ],
  "max_blocks": 3,
  "blocks": [
    {
      "type": "bundle",
      "name": "Bundle",
      "settings": [
        {
          "type": "text",
          "id": "bundle_name",
          "label": "Bundle Name",
          "default": "Performance Starter Pack"
        },
        {
          "type": "textarea",
          "id": "bundle_description",
          "label": "Bundle Description",
          "default": "Everything you need to kickstart your Sloe Fit journey."
        },
        {
          "type": "textarea",
          "id": "bundle_items",
          "label": "Bundle Items (comma separated)",
          "default": "Edge Pre-Workout (1), Recover BCAAs (1)"
        },
        {
          "type": "text",
          "id": "original_price",
          "label": "Original Price",
          "default": "84.98"
        },
        {
          "type": "text",
          "id": "bundle_price",
          "label": "Bundle Price",
          "default": "69.99"
        },
        {
          "type": "text",
          "id": "savings",
          "label": "Savings Amount",
          "default": "14.99"
        },
        {
          "type": "url",
          "id": "cta_url",
          "label": "Add to Cart URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Bundle Selector"
    }
  ]
}
{% endschema %}
